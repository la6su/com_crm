# Joomla AI-Driven CRM Component

ÐŸÑ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿ CRM ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ ÑÐ¾ ÑÑ‚Ñ€Ð¾Ð³Ð¾Ð¹ State Machine Ð»Ð¾Ð³Ð¸ÐºÐ¾Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð².
Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ.

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº
1. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ `com_crm` Ð² `/administrator/components/`.
2. Ð’ Ð°Ð´Ð¼Ð¸Ð½ÐºÐµ Joomla: **System -> Install -> Discover**.
3. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚.
4. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ: `http://localhost:8080/administrator/index.php?option=com_crm&view=company&id=1`

## ðŸ— ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°
* **Ð¢Ð¸Ð¿:** Native Joomla 5/6 MVC Component.
* **Service Layer:** Ð’ÑÑ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ° (Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð²) Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð² ÐºÐ»Ð°ÑÑÐµ `StageService.php`. ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ñ‹ Ð¸ ÐœÐ¾Ð´ÐµÐ»Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ ÑÑ‚Ð¾Ñ‚ ÑÐµÑ€Ð²Ð¸Ñ. Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð±ÐµÐ· Ð‘Ð”.
* **Ð‘Ð”:** 
  * `crm_companies`: Ð”ÐµÐ½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÑ‚Ð°Ð´Ð¸Ð¸ (`stage_code`) Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ð²Ñ‹Ð±Ð¾Ñ€Ð¾Ðº. ÐŸÐ¾Ð»Ðµ `context_data` (JSON) Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ñ„Ð»Ð°Ð³Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑƒÑÐ»Ð¾Ð²Ð¸Ð¹ (NoSQL Ð¿Ð¾Ð´Ñ…Ð¾Ð´ Ð´Ð»Ñ Ð³Ð¸Ð±ÐºÐ¾ÑÑ‚Ð¸).
  * `crm_history`: Ð–ÑƒÑ€Ð½Ð°Ð» Ð°ÑƒÐ´Ð¸Ñ‚Ð° (ÐºÑ‚Ð¾, ÐºÐ¾Ð³Ð´Ð°, Ñ‡Ñ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ð»).

## ðŸ›¡ ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ (Ð´Ð¾ 10k/day)
1. **Ð˜Ð½Ð´ÐµÐºÑÑ‹:** Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð½Ð° `stage_code` (Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð²Ð¾Ñ€Ð¾Ð½Ð¾Ðº) Ð¸ `company_id` (Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ).
2. **JSON Context:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ JSON Ð´Ð»Ñ Ñ„Ð»Ð°Ð³Ð¾Ð² Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ðµ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð² (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, "Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¡Ð‘") Ð±ÐµÐ· Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‰Ð¸Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ `ALTER TABLE` Ð½Ð° Ð³Ð¸Ð³Ð°Ð½Ñ‚ÑÐºÐ¸Ñ… Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°Ñ….
3. **ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾ÑÑ‚ÑŒ (ÐŸÐ»Ð°Ð½):** Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸ÑŽ ÑÑ‡ÐµÑ‚Ð¾Ð² Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ Email Ð¼Ð¾Ð¶Ð½Ð¾ Ð²Ñ‹Ð½ÐµÑÑ‚Ð¸ Ð² Joomla Task Scheduler.

## ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (TDD Cycle)
Ð›Ð¾Ð³Ð¸ÐºÐ° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð² Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð° Unit-Ñ‚ÐµÑÑ‚Ð°Ð¼Ð¸ (PHPUnit).
Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ñ†Ð¸ÐºÐ»Ð° "Bug -> Fix":
1. **Bug:** ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¼Ð¾Ð³ Ð¿ÐµÑ€ÐµÐ²ÐµÑÑ‚Ð¸ ÑÐ´ÐµÐ»ÐºÑƒ Ð² "ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾" Ð±ÐµÐ· Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑ‡ÐµÑ‚Ð°.
2. **Test:** ÐÐ°Ð¿Ð¸ÑÐ°Ð½ Ñ‚ÐµÑÑ‚ `testCannotSkipInvoiceCreation`. Ð¢ÐµÑÑ‚ ÑƒÐ¿Ð°Ð» (Red).
3. **Fix:** Ð’ `StageService` Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ ÑÑ‚Ñ€Ð¾Ð³Ð¾Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ðµ `req => 'invoice_created'` Ð´Ð»Ñ ÑÑ‚Ð°Ð´Ð¸Ð¸ W3.
4. **Result:** Ð¢ÐµÑÑ‚ Ð¿Ñ€Ð¾ÑˆÐµÐ» (Green).

## ðŸ¤– AI Workflow (ÐžÑ‚Ñ‡ÐµÑ‚)
Ð”Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð»ÑÑ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸-Ð°Ð³ÐµÐ½Ñ‚Ð½Ñ‹Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´.

1. **Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð´Ð°:**
   * *Prompt:* "Create Joomla 5 MVC boilerlate with strict types".
   * *Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:* Ð¡ÑÐºÐ¾Ð½Ð¾Ð¼Ð»ÐµÐ½Ð¾ 30 Ð¼Ð¸Ð½ÑƒÑ‚ Ð½Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ñ„Ð°Ð¹Ð»Ð¾Ð².
2. **Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ°:**
   * *Prompt:* Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¸Ð· Ð¢Ð—. Ð—Ð°Ð¿Ñ€Ð¾Ñ: "Convert this transition table to PHP array constant".
   * *Validation:* AI Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð» Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ð² Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ð¸ ÑÑ‚Ð°Ð´Ð¸Ð¹ (W1/W2), Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¿Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ñƒ Ð·Ð°Ð´Ð°Ñ‡Ð¸.
3. **ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ñ€Ð¸ÑÐºÐ¾Ð²:**
   * ÐšÐ¾Ð´ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½ Ð½Ð° SQL Injection (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ `$db->quoteName`).
   * Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ CSRF (Ð² ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ðµ).
